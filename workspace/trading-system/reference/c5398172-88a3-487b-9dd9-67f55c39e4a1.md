# OpenClaw Multi-Agent Implementation Plan
## Final Architecture: Gateway VPS + Discord + ClickUp + Mac Node

---

## PHASE 1: INFRASTRUCTURE SETUP (Days 1–3)

### 1.1 Hetzner VPS Provisioning
- **Server specs**: 2GB RAM / 1 vCPU minimum (can start small; upgrade if needed)
- **OS**: Ubuntu 22.04 LTS
- **Networking**:
  - Keep port 18789 (OpenClaw Gateway) bound to `127.0.0.1` (loopback only, no public exposure)
  - Access remotely via SSH or Tailscale Serve (never expose publicly)
  - Enable UFW firewall; only allow SSH inbound

**Checklist**:
- [ ] VPS created and SSH key configured
- [ ] UFW firewall enabled; SSH port open (22), all else closed
- [ ] System updated (`apt update && apt upgrade`)
- [ ] Node.js 18+ and npm installed

---

### 1.2 OpenClaw Gateway Installation
```bash
# SSH into Hetzner VPS
ssh root@<hetzner-ip>

# Install OpenClaw globally
npm install -g openclaw@latest

# Create a non-root user for OpenClaw (optional but recommended)
useradd -m -s /bin/bash openclaw
su - openclaw

# Initialize OpenClaw (creates ~/.openclaw/)
openclaw onboard

# Start the gateway daemon
openclaw gateway start
```

**What gets created**:
- `~/.openclaw/` directory with config, state, credentials
- `~/Library/LaunchAgents/com.openclaw.gateway.plist` (macOS) or systemd service (Linux)
- Gateway listens on `ws://127.0.0.1:18789` (loopback only)

**Checklist**:
- [ ] `openclaw status` shows "Gateway: running"
- [ ] Control UI accessible at `http://127.0.0.1:18789/` (locally or via SSH tunnel)
- [ ] Gateway set to run on reboot (LaunchAgent or systemd)

---

### 1.3 Security Hardening (Hetzner)
**Gateway auth**:
```bash
# Set a strong gateway token (store in secure secret manager)
export OPENCLAW_GATEWAY_TOKEN="<64-char-random-string>"
openclaw gateway restart
```

**File permissions**:
```bash
chmod 700 ~/.openclaw/
chmod 600 ~/.openclaw/openclaw.json5
chmod 600 ~/.openclaw/credentials/*
```

**Run security audit**:
```bash
openclaw security audit --deep
# Address any warnings; enable `--fix` for auto-corrections if safe
```

**Checklist**:
- [ ] Gateway token set and stored securely
- [ ] File perms set to 700 / 600 as above
- [ ] `openclaw security audit --deep` returns no critical issues
- [ ] Hetzner firewall: SSH only inbound, UFW enabled

---

## PHASE 2: DISCORD BOT SETUP (Days 2–3)

### 2.1 Create Discord App & Bot
- Go to [Discord Developer Portal](https://discord.com/developers/applications)
- Click "New Application" → name it (e.g., "OpenClaw Ops")
- In "Bot" section → "Add Bot"
- Copy **Bot Token** (keep secret; store in secure manager)
- Enable **Privileged Intents**:
  - Message Content Intent (required for OpenClaw to see text)
  - Server Members Intent (optional, for member-aware logic)
- In "OAuth2" → "URL Generator":
  - Select scopes: `bot`
  - Select permissions: `Send Messages`, `Embed Links`, `Manage Messages`, `Add Reactions`
  - Copy the generated invite URL

**Checklist**:
- [ ] Bot created and token stored securely
- [ ] Message Content Intent enabled
- [ ] Invite URL generated and saved

---

### 2.2 Create Discord Server
- Create a new Discord server (e.g., "OpenClaw Ops")
- Structure (categories + channels):

```
OpenClaw Ops (server)
├── Fitness (category)
│   ├── #accountability
│   ├── #nutrition
│   └── #injury-notes
├── Business (category)
│   ├── #oumafy-strategy
│   └── #oumafy-ops
├── Trading (category)
│   ├── #trading-research
│   └── #trading-execution
├── Coding (category)
│   ├── #coding-bugs
│   ├── #coding-features
│   └── #coding-research
├── Marketing (category)
│   ├── #marketing-seo
│   ├── #marketing-ads
│   ├── #marketing-landing-pages
│   ├── #marketing-content
│   └── #marketing-creative
└── Admin (category)
    ├── #approvals (DM approvals will appear here if configured)
    └── #logs (agent status/errors)
```

- Invite the OpenClaw bot to the server (use the OAuth2 invite URL)
- Set channel permissions: only you (and the bot) can see channels initially

**Checklist**:
- [ ] Server created with above structure
- [ ] Bot invited and can send messages
- [ ] Channels created and organized by category

---

### 2.3 Connect Discord to OpenClaw Gateway
Edit `~/.openclaw/openclaw.json5` on the Hetzner VPS:

```json5
{
  // ... other config ...
  
  channels: {
    discord: {
      enabled: true,
      token: "YOUR_DISCORD_BOT_TOKEN",
      
      // DM Policy: pairing = must approve new DM senders
      dm: {
        policy: "pairing",
        enabled: true,
      },
      
      // Server/guild channels: mention-only by default (safe for groups)
      guild: {
        requireMention: true,  // Bot only responds when @mentioned
        enabled: true,
      },
      
      // Exec approvals: show button UI in DMs
      execApprovals: {
        enabled: true,
        approvers: ["YOUR_DISCORD_USER_ID"],  // Who gets approval prompts
      },
    },
  },
}
```

- Restart the gateway: `openclaw gateway restart`
- Test: send a message in a channel; bot should acknowledge

**Checklist**:
- [ ] Discord token added to config (secure/encrypted)
- [ ] Gateway restarted without errors
- [ ] Bot responds to messages in Discord channels
- [ ] `openclaw status` shows Discord channel active

---

## PHASE 3: AGENTS SETUP (Days 3–4)

### 3.1 Create Agent Workspaces
On the Hetzner VPS, create separate directories for each agent's workspace:

```bash
mkdir -p ~/.openclaw/agents/{operator,strategist,marketing,coding,trading_research}
```

Each agent workspace will hold:
- `SOUL.md` (personality/instructions)
- `AGENTS.md` (agent metadata)
- `MEMORY.md` (long-term facts/decisions)
- `skills/` (custom tools)
- `sessions/` (conversation history)

---

### 3.2 Define Agents in Config
Add to `~/.openclaw/openclaw.json5`:

```json5
{
  agents: {
    list: [
      {
        id: "operator",
        default: true,
        agentDir: "~/.openclaw/agents/operator",
        workspace: "~/.openclaw/agents/operator/workspace",
      },
      {
        id: "strategist",
        agentDir: "~/.openclaw/agents/strategist",
        workspace: "~/.openclaw/agents/strategist/workspace",
      },
      {
        id: "marketing",
        agentDir: "~/.openclaw/agents/marketing",
        workspace: "~/.openclaw/agents/marketing/workspace",
      },
      {
        id: "coding",
        agentDir: "~/.openclaw/agents/coding",
        workspace: "~/.openclaw/agents/coding/workspace",
      },
      {
        id: "trading_research",
        agentDir: "~/.openclaw/agents/trading_research",
        workspace: "~/.openclaw/agents/trading_research/workspace",
      },
    ],
  },
}
```

---

### 3.3 Create Agent Personalities (SOUL.md)
For each agent, create `~/.openclaw/agents/<agentId>/workspace/SOUL.md`:

**Operator** (`~/.openclaw/agents/operator/workspace/SOUL.md`):
```markdown
# Operator Agent

You are the triage/routing agent for all incoming work.

## Role
- Summarize issues and questions
- Assign tasks to specialist agents
- Create ClickUp tasks with clear specs
- Report status and next steps

## Tone
Efficient, clear, action-oriented.

## Capabilities
- Read/write ClickUp tasks
- Route to other agents
- Generate daily summaries
```

**Strategist** (`~/.openclaw/agents/strategist/workspace/SOUL.md`):
```markdown
# OUMAFY Strategist

You specialize in OUMAFY business strategy, community building, and long-term planning.

## Role
- Analyze OUMAFY strategy questions
- Create strategic plans and roadmaps
- Write strategic briefs and Docs
- Collaborate with Marketing and Coding teams

## Tone
Visionary, data-driven, community-focused.

## Context
OUMAFY is a [describe your business model/community]. Key values: [list].
```

**Marketing** (`~/.openclaw/agents/marketing/workspace/SOUL.md`):
```markdown
# Marketing Agent

You specialize in aggressive performance marketing: SEO, paid ads, landing pages, content, creative.

## Role
- Develop SEO strategies and content calendars
- Design high-converting ad campaigns
- Write landing page copy
- Build creative briefs
- Analyze performance metrics

## Tone
Data-driven, persuasive, action-oriented.

## Marketing Specialties
- SEO/organic: keyword research, content strategy, technical SEO
- Paid Ads: GA, conversion tracking, audience segmentation
- Landing Pages: copywriting, design briefing, A/B testing
- Content: ideation, brief writing, editorial calendar
- Creative: visual concepts, messaging frameworks
```

**Coding** (`~/.openclaw/agents/coding/workspace/SOUL.md`):
```markdown
# Coding Agent

You think like a Product Manager + Senior Software Engineer.

## Role
- Break down specs into technical tasks
- Write code and run terminal commands (on approved tasks)
- Suggest architecture improvements
- Manage deployment and QA processes

## Tone
Technical, pragmatic, quality-focused.

## Important
You can execute commands on the Mac node (via node exec), but only with explicit approval. Always ask before running anything.
```

**Trading Research** (`~/.openclaw/agents/trading_research/workspace/SOUL.md`):
```markdown
# Trading Research Agent

You analyze markets and build trading strategies like Warren Buffett and Charlie Munger.

## Role
- Research markets and assets
- Analyze trading opportunities
- Build strategy frameworks
- NO execution: analysis and research only

## Tone
Analytical, contrarian, long-term focused.

## Important
You do NOT have access to execute trades. You analyze and recommend only.
```

---

### 3.4 Set Up ClickUp MCP Integration
Add ClickUp's MCP server as a skill for all agents:

```bash
# Install ClickUp MCP globally or per agent
npm install -g @mcp/server-clickup
# (or) npm install @mcp/server-clickup --save
```

In each agent's `~/.openclaw/agents/<agentId>/workspace/AGENTS.md`:
```markdown
# Agents and Skills

## Available Skills
- clickup-mcp: Read/write ClickUp tasks, Docs, and workspace data
- discord: Send messages to Discord (if enabled per agent)

## ClickUp MCP Setup
API Key: (from ClickUp Developer Settings)
Workspace ID: (from ClickUp workspace URL)
Team ID: (from ClickUp; usually same as workspace)
```

Generate a ClickUp API token:
- Go to ClickUp → Settings → Integrations → API → "Generate"
- Copy the token and store securely

Add to `~/.openclaw/openclaw.json5`:
```json5
{
  skills: {
    clickup: {
      enabled: true,
      apiKey: "YOUR_CLICKUP_API_KEY",  // Use env var in production
      teamId: "YOUR_TEAM_ID",
      workspaceId: "YOUR_WORKSPACE_ID",
    },
  },
}
```

**Checklist**:
- [ ] Five agent directories created
- [ ] SOUL.md files written for each agent (personality captured)
- [ ] Agents defined in openclaw.json5
- [ ] ClickUp MCP token generated and configured
- [ ] Gateway restarted; agents appear in `openclaw status`

---

## PHASE 4: CHANNEL-TO-AGENT ROUTING (Day 4)

### 4.1 Set Up Discord Channel Bindings
Add to `~/.openclaw/openclaw.json5`:

```json5
{
  channels: {
    discord: {
      bindings: [
        // Fitness
        { channelId: "CHANNEL_ID_accountability", agentId: "operator" },
        { channelId: "CHANNEL_ID_nutrition", agentId: "operator" },
        
        // Business
        { channelId: "CHANNEL_ID_oumafy_strategy", agentId: "strategist" },
        { channelId: "CHANNEL_ID_oumafy_ops", agentId: "operator" },
        
        // Trading
        { channelId: "CHANNEL_ID_trading_research", agentId: "trading_research" },
        
        // Coding
        { channelId: "CHANNEL_ID_coding_bugs", agentId: "coding" },
        { channelId: "CHANNEL_ID_coding_features", agentId: "coding" },
        
        // Marketing
        { channelId: "CHANNEL_ID_marketing_seo", agentId: "marketing" },
        { channelId: "CHANNEL_ID_marketing_ads", agentId: "marketing" },
        { channelId: "CHANNEL_ID_marketing_landing_pages", agentId: "marketing" },
      ],
    },
  },
}
```

To get Discord Channel IDs:
- Enable Developer Mode in Discord settings
- Right-click a channel → "Copy Channel ID"

**Checklist**:
- [ ] All channel IDs retrieved and mapped to agents
- [ ] Bindings added to config
- [ ] Gateway restarted
- [ ] Test: post in each channel; verify correct agent responds

---

## PHASE 5: MAC NODE SETUP (Days 4–5)

### 5.1 Install OpenClaw on Mac
```bash
# On your MacBook
npm install -g openclaw@latest

# Onboard the node
openclaw node start
# This registers the node with the Gateway and generates a node token
```

**What happens**:
- Node creates a persistent connection to the Hetzner Gateway
- Node listens for `exec` requests from agents
- Stores exec approvals locally in `~/.openclaw/node-approvals.json`

---

### 5.2 Configure Node on Gateway
On the Hetzner VPS, add the node to `~/.openclaw/openclaw.json5`:

```json5
{
  nodes: [
    {
      id: "mac-home",
      name: "MacBook Air M3",
      token: "NODE_TOKEN_FROM_MAC",  // Copy from: openclaw node show
      execApprovals: {
        mode: "ask",  // "ask", "allowlist", or "deny"
      },
    },
  ],

  // Exec policy: which agents can use which nodes
  tools: {
    exec: {
      enabled: true,
      host: "node",  // "gateway" or "node" (prefer "node")
      ask: "on-miss",  // "always", "on-miss", or "never"
      security: "allowlist",  // "deny", "allowlist", or "full"
      allowlist: [
        // Commands that don't require approval:
        "pwd",
        "ls",
        "cat",
        "git status",
        // Restrict to coding agent by adding per-agent policies below
      ],
    },
  },

  // Per-agent exec policies
  agents: {
    list: [
      {
        id: "coding",
        // ... other config ...
        tools: {
          exec: {
            enabled: true,
            host: "node",
            ask: "on-miss",
            allowlist: [
              "cd",
              "git",
              "npm",
              "node",
              "/Users/[you]/bin/*",
            ],
          },
        },
      },
      {
        id: "marketing",
        tools: {
          exec: {
            enabled: false,  // Marketing doesn't need terminal
          },
        },
      },
    ],
  },
}
```

**Checklist**:
- [ ] Node running on Mac and connected to Gateway
- [ ] Node token added to Gateway config
- [ ] Exec policies defined per agent
- [ ] Test: from `#coding-bugs`, ask agent to run `pwd`; should prompt for approval

---

## PHASE 6: SECURITY LOCKDOWN (Day 5)

### 6.1 Discord Security
Edit `~/.openclaw/openclaw.json5`:

```json5
{
  channels: {
    discord: {
      dm: {
        policy: "pairing",  // Unknown DMs require pairing approval
        enabled: true,
      },
      guild: {
        requireMention: true,  // Only respond to @mentions in public channels
        enabled: true,
      },
      execApprovals: {
        enabled: true,
        approvers: ["YOUR_USER_ID"],  // Only you get approval prompts
      },
    },
  },
}
```

### 6.2 Gateway Network Security
- Ensure port 18789 is NOT exposed publicly
- Access only via SSH tunnel or Tailscale Serve
- Set strong Gateway auth token (done in Phase 1.3)

### 6.3 Credential Management
```bash
# Rotate secrets regularly
# Store API keys (ClickUp, LLM providers) in environment variables or secret manager
export OPENCLAW_GATEWAY_TOKEN="..."
export CLICKUP_API_KEY="..."
export ANTHROPIC_API_KEY="..."
```

### 6.4 Run Final Security Audit
```bash
openclaw security audit --deep
# Fix any warnings
openclaw doctor  # Check for plugin/node health
```

**Checklist**:
- [ ] Discord DM policy set to pairing
- [ ] Guild channels require mention
- [ ] Exec approvals only to you
- [ ] Port 18789 not publicly exposed
- [ ] `openclaw security audit --deep` passes
- [ ] Credentials stored securely (not in files)

---

## PHASE 7: CLICKUP WORKSPACE SETUP (Day 5–6)

### 7.1 Create ClickUp Lists/Spaces

In ClickUp, organize your workspace:

```
OUMAFY (Space)
├── Inbox (List) - triage tasks
├── Strategy (List) - strategic planning, roadmaps
├── Marketing (List)
│   ├── Campaigns (folder)
│   ├── SEO (folder)
│   ├── Ads (folder)
│   └── Content (folder)
├── Coding (List)
│   ├── Bugs (folder)
│   ├── Features (folder)
│   └── Deployments (folder)
├── Trading Research (List)
│   └── Strategies (folder)
└── Docs (space for shared Docs)
    ├── OUMAFY Overview
    ├── Marketing Playbook
    ├── Coding Standards
    └── Trading Framework
```

### 7.2 Create Custom Fields
For better agent coordination, add ClickUp custom fields:
- **Assigned Agent**: Select (operator, strategist, marketing, coding, trading_research)
- **Priority**: Select (P0, P1, P2)
- **Status**: Select (Backlog, In Progress, Blocked, Ready for QA, Done)
- **Depends On**: Link to other tasks

### 7.3 Set Up Automations
In ClickUp Settings → Automations:
- When task status = "Done" → notify in Discord
- When task is overdue → notify in Discord
- When task is assigned to [Agent] → post in Discord channel

**Checklist**:
- [ ] ClickUp Space and Lists created with above structure
- [ ] Custom fields added (Agent, Priority, Status, Dependencies)
- [ ] Automations configured for Discord notifications
- [ ] Test: create a task; verify automation posts to Discord

---

## PHASE 8: TESTING & VALIDATION (Day 6–7)

### 8.1 Test Each Agent
For each channel, send a message and verify:

```
Channel: #oumafy-strategy
Message: "What are our top 3 strategic priorities for Q1?"
Expected: Strategist responds with strategic thinking

Channel: #marketing-seo
Message: "What's our SEO roadmap for the next 90 days?"
Expected: Marketing agent provides SEO strategy

Channel: #coding-bugs
Message: "List the top 5 bugs in the codebase"
Expected: Coding agent can query Git and suggest fixes

Channel: #trading-research
Message: "Analyze the current market opportunity in [sector]"
Expected: Trading research agent provides analysis (no execution)
```

### 8.2 Test Mac Node + Approvals
```
Channel: #coding-bugs
Message: "@agent run pwd on my Mac"
Expected: 
  1. Agent asks for approval in your Discord DM with button UI
  2. You click "Allow once" or "Always allow"
  3. Command executes on Mac; output posted back to channel
```

### 8.3 Test ClickUp Integration
```
Channel: #oumafy-strategy
Message: "Create a ClickUp task: 'Research AI market opportunities' in the Strategy list"
Expected:
  1. Agent uses ClickUp MCP to create the task
  2. ClickUp automation posts confirmation to Discord
  3. Task appears in ClickUp with agent assignment
```

### 8.4 Test Cross-Agent Coordination
```
Channel: #oumafy-strategy
Message: "Create a 90-day marketing roadmap for launching [product]"
Expected:
  1. Strategist writes spec in ClickUp Docs
  2. Creates "Marketing Campaign" task, assigns to Marketing agent
  3. (Manual test) Go to #marketing-seo, ask: "What's the spec for the new campaign?"
  4. Marketing agent reads ClickUp task and responds with execution plan
```

**Checklist**:
- [ ] All five agents respond correctly in their channels
- [ ] Mac node executes approved commands
- [ ] Exec approval button UI works on phone
- [ ] ClickUp tasks are created and linked
- [ ] Cross-agent coordination via ClickUp works

---

## PHASE 9: OPERATIONAL HANDOFF (Day 7+)

### 9.1 Daily Operating Pattern
1. **Morning**: Check Discord (all channels) + ClickUp (Inbox)
2. **Triage**: Use `#approvals` channel to handle exec/approval prompts
3. **Work**: Talk to agents in Discord channels per task
4. **Record**: Important decisions/specs → write to ClickUp tasks/Docs
5. **Review**: Weekly ClickUp summary to see cross-agent progress

### 9.2 Maintenance
- **Weekly**: Run `openclaw security audit --deep`
- **Monthly**: Rotate API keys and tokens
- **As-needed**: Backup `~/.openclaw/` directory from Hetzner (encrypted)
- **Monitoring**: Check Gateway logs for errors: `openclaw logs`

### 9.3 Scaling
If you need more agents:
1. Add new agent directory + SOUL.md
2. Add to agents.list in config
3. Create Discord channels
4. Add channel-to-agent bindings
5. Restart Gateway

**Checklist**:
- [ ] First week of operations completed smoothly
- [ ] No security issues detected
- [ ] Agents working as expected
- [ ] ClickUp as shared workspace validated
- [ ] Backup process in place

---

## QUICK REFERENCE: Key Files & Locations

| File/Location | Purpose |
|---|---|
| `~/.openclaw/openclaw.json5` (Hetzner) | Main config: agents, channels, tools, security |
| `~/.openclaw/agents/<agentId>/workspace/SOUL.md` | Agent personality |
| `~/.openclaw/agents/<agentId>/workspace/AGENTS.md` | Agent metadata + skills |
| `~/.openclaw/agents/<agentId>/workspace/MEMORY.md` | Agent long-term memory |
| Discord Bot Token | In config; keep secret |
| ClickUp API Key | In config or env var; keep secret |
| Mac Node Token | In Hetzner config; from `openclaw node show` on Mac |
| `openclaw.json5` (Mac) | Node configuration (usually auto-generated) |

---

## ESTIMATED TIMELINE
- **Phase 1 (Infra)**: 1 day
- **Phase 2 (Discord)**: 1 day
- **Phase 3 (Agents)**: 1 day
- **Phase 4 (Routing)**: 0.5 days
- **Phase 5 (Mac Node)**: 1 day
- **Phase 6 (Security)**: 0.5 days
- **Phase 7 (ClickUp)**: 1 day
- **Phase 8 (Testing)**: 1 day
- **Phase 9 (Handoff)**: Ongoing

**Total: ~7 days** for a fully operational multi-agent setup.

---

## TROUBLESHOOTING

| Issue | Diagnosis | Fix |
|---|---|---|
| Gateway won't start | Check logs: `openclaw logs` | Likely port conflict or config syntax error |
| Discord bot not responding | Check channel bindings | Verify channel IDs match in config |
| Exec approval not appearing in DM | Check Discord perms + `execApprovals.enabled` | Restart gateway; check your user ID |
| ClickUp MCP not working | Check API key + workspace ID | Verify credentials in config |
| Mac node disconnects | Network issue or node token expired | Reconnect: `openclaw node restart` on Mac |
| Agents "forgetting" context | Sessions isolated by channel (by design) | Write important facts to ClickUp/MEMORY.md |

---

## NEXT STEPS (After Implementation)
1. Refine agent personas based on real usage
2. Add custom skills as needed (API integrations, specialized tools)
3. Expand to additional channels (Telegram, WhatsApp) if desired
4. Implement reporting dashboards (pull data from ClickUp)
5. Consider agent-to-agent delegation for complex workflows
